# 서브 쿼리
쿼리 안에 쿼리를 만드는 것을 `서브 쿼리`라고 한다.  

### 예시
* 나이가 평균보다 많은 회원 조회  
[select m from Member m where m.age > `(select avg(m2.age) from Member m2)`]
  
* 한 건이라도 주문한 고객 조회  
[select m from Member m where `(select count(o) from Order o where m = o.member)` > 0]
  
## 서브 쿼리 지원 함수
* [NOT] EXISTS (subquery) : 서브쿼리에 `결과가 존재하면` 참.   
  * ex: `팀A` 소속인 회원 조회  
    * SELECT m FROM Member m `where exists (select t FROM Team T where t.name = '팀A')`
<br></br>
    
* All (subquery) : `모두 만족`하면 참. <br></br>
  * ex: 전체 상품 각각의 재고보다 주문량이 많은 주문들 `전체 조회`
    * select o from Order o `where o.orderAmount > All (select p.stockAmount from Product p)`
<br></br>
    
* Any, Some (subquery) : `조건을 하나라도 만족`하면 참. 
  * ex: 어떤 팀이든 소속 팀이 있는 회원
    * select m from Member m `where any (select t from Team t)`
<br></br>
    
* [NOT] IN (subquery) : 서브쿼리에 결과 중 `하나라도 같은 것이 있으면` 참. <br></br>

## 주의할 점
* JPA 표준스펙에서는 `WHERE`, `HAVING` 절에서만 `서브 쿼리`를 사용 가능하다.
* 하이버네이트에서 `SELECT` 절도 가능하게 지원을 해준다.
  <br></br>  
* **단, `FROM`절의 서브쿼리는 현재 `JPQL`에서 불가능함.**
    1. **`조인`으로 풀 수 있으면 풀어서 해결하자.** (BEST)
    2. 서브쿼리 전 단계의 데이터를 가져와서 `애플리케이션 단계`에서 조작하여 해결
    3. `쿼리를 분해`해서 날리자.
    4. 최후의 수단으로 `NativeSQL`로 해결